---
// src/components/Pagination.astro (range fonksiyonunu kullanan ve query parametreli)
import { range } from "../utils/range"; // <-- Oluşturduğunuz range.ts dosyasını import ediyoruz

export interface Props {
  currentPage: number;
  totalPages: number;
  basePath: string; // "/blog" olarak gelecek
}

const { currentPage, totalPages, basePath } = Astro.props;

const pageNumbersToDisplay = range(1, totalPages); // range fonksiyonunu kullanarak [1, 2, ..., totalPages] dizisini oluşturuyoruz

// Çok fazla sayfa varsa gösterilecek sayfa aralığını sınırlama mantığı (Opsiyonel İyileştirme)
const maxPagesToShow = 5; // Ortada gösterilecek maksimum sayfa sayısı (Örn: 1 ... 4 5 6 ... 10)
let startPage: number, endPage: number;
if (totalPages <= maxPagesToShow) {
  // Toplam sayfa sayısı max'tan az veya eşitse hepsini göster
  startPage = 1;
  endPage = totalPages;
} else {
  // Ortadaki sayfaları hesapla
  const maxPagesBeforeCurrent = Math.floor((maxPagesToShow - 1) / 2);
  const maxPagesAfterCurrent = Math.ceil((maxPagesToShow - 1) / 2);
  if (currentPage <= maxPagesBeforeCurrent) {
    // Başa yakınsa: 1, 2, 3, 4, 5 ...
    startPage = 1;
    endPage = maxPagesToShow;
  } else if (currentPage + maxPagesAfterCurrent >= totalPages) {
    // Sona yakınsa: ... 6, 7, 8, 9, 10
    startPage = totalPages - maxPagesToShow + 1;
    endPage = totalPages;
  } else {
    // Ortadaysa: ... 3, 4, 5, 6, 7 ...
    startPage = currentPage - maxPagesBeforeCurrent;
    endPage = currentPage + maxPagesAfterCurrent;
  }
}
// Sınırlı sayfa numarası dizisi (eğer yukarıdaki mantığı kullanırsanız)
const limitedPageNumbers = range(startPage, endPage);
// Eğer tüm sayfaları göstermek isterseniz: const limitedPageNumbers = pageNumbersToDisplay;

const hasPrev = currentPage > 1;
const hasNext = currentPage < totalPages;
---

{
  totalPages > 1 && (
    <nav class="mt-12" aria-label="Sayfalama">
      <ul class="inline-flex items-center -space-x-px">
        {/* Önceki Sayfa Linki */}
        <li>
          <a
            href={hasPrev ? `${basePath}${currentPage - 1 === 1 ? '' : `?page=${currentPage - 1}`}` : "#"}
            class:list={[
              "ml-0 rounded-l-lg border border-gray-300 bg-white px-3 py-2 leading-tight text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white",
              { "pointer-events-none opacity-50": !hasPrev },
            ]}
            aria-disabled={!hasPrev ? "true" : "false"}
            aria-label="Önceki Sayfa"
          >
            <span class="sr-only">Önceki</span>
            <svg class="h-3 w-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 1 1 5l4 4"/> </svg>
          </a>
        </li>

        {/* Sayfa Numarası Linkleri (Sınırlı veya Tamamı) */}
        {/* Eğer sınırlı gösterme mantığını kullanıyorsanız limitedPageNumbers, yoksa pageNumbersToDisplay */}
        {limitedPageNumbers.map((page) => (
          <li>
            <a
              href={`${basePath}${page === 1 ? '' : `?page=${page}`}`}
              class:list={[
                "border border-gray-300 bg-white px-3 py-2 leading-tight text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white",
                {
                  "bg-primary-50 text-primary-600 hover:bg-primary-100 hover:text-primary-700 dark:border-gray-700 dark:bg-gray-700 dark:text-white":
                    currentPage === page,
                },
              ]}
              aria-current={currentPage === page ? "page" : undefined}
            >
              {page}
            </a>
          </li>
        ))}

        {/* Sonraki Sayfa Linki */}
        <li>
          <a
            href={hasNext ? `${basePath}?page=${currentPage + 1}` : "#"}
            class:list={[
              "rounded-r-lg border border-gray-300 bg-white px-3 py-2 leading-tight text-gray-500 hover:bg-gray-100 hover:text-gray-700 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white",
              { "pointer-events-none opacity-50": !hasNext },
            ]}
            aria-disabled={!hasNext ? "true" : "false"}
            aria-label="Sonraki Sayfa"
          >
            <span class="sr-only">Sonraki</span>
            <svg class="h-3 w-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 6 10"> <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 9 4-4-4-4"/> </svg>
          </a>
        </li>
      </ul>
    </nav>
  )
}